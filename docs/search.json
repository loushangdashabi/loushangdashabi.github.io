[
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "åœ¨ R ä¸­ä½¿ç”¨ Python æ¨¡å— Mesa æ¥åˆ›å»º ABM æ¨¡å‹",
    "section": "",
    "text": "(åªéœ€è¦è¿è¡Œä¸€æ¬¡)\n\nlibrary(reticulate)\ninstall_miniconda()\nconda_create(envname = \"mesa-abm\", python_version = \"3.13.5\")\npy_install(c(\"mesa[all]\",\"seaborn\"), envname = \"mesa-abm\", pip = TRUE)\n\n\n\n\n(æ¯æ¬¡éƒ½éœ€è¦è¿è¡Œ)\n\nlibrary(reticulate)\nuse_condaenv(\"mesa-abm\", required = TRUE)\n\n\n\n\n\nimport mesa\nimport seaborn as sns\nimport numpy as np\nimport pandas as pd\nimport matplotlib.pyplot as plt"
  },
  {
    "objectID": "index.html#å®‰è£…-python-ç¯å¢ƒå¹¶å®‰è£…-mesa",
    "href": "index.html#å®‰è£…-python-ç¯å¢ƒå¹¶å®‰è£…-mesa",
    "title": "åœ¨ R ä¸­ä½¿ç”¨ Python æ¨¡å— Mesa æ¥åˆ›å»º ABM æ¨¡å‹",
    "section": "",
    "text": "(åªéœ€è¦è¿è¡Œä¸€æ¬¡)\n\nlibrary(reticulate)\ninstall_miniconda()\nconda_create(envname = \"mesa-abm\", python_version = \"3.13.5\")\npy_install(c(\"mesa[all]\",\"seaborn\"), envname = \"mesa-abm\", pip = TRUE)"
  },
  {
    "objectID": "index.html#å¯åŠ¨-python-ç¯å¢ƒ",
    "href": "index.html#å¯åŠ¨-python-ç¯å¢ƒ",
    "title": "åœ¨ R ä¸­ä½¿ç”¨ Python æ¨¡å— Mesa æ¥åˆ›å»º ABM æ¨¡å‹",
    "section": "",
    "text": "(æ¯æ¬¡éƒ½éœ€è¦è¿è¡Œ)\n\nlibrary(reticulate)\nuse_condaenv(\"mesa-abm\", required = TRUE)"
  },
  {
    "objectID": "index.html#å¯¼å…¥éœ€è¦çš„-python-æ¨¡å—",
    "href": "index.html#å¯¼å…¥éœ€è¦çš„-python-æ¨¡å—",
    "title": "åœ¨ R ä¸­ä½¿ç”¨ Python æ¨¡å— Mesa æ¥åˆ›å»º ABM æ¨¡å‹",
    "section": "",
    "text": "import mesa\nimport seaborn as sns\nimport numpy as np\nimport pandas as pd\nimport matplotlib.pyplot as plt"
  },
  {
    "objectID": "index.html#åˆ›å»º-agent-ç±»",
    "href": "index.html#åˆ›å»º-agent-ç±»",
    "title": "åœ¨ R ä¸­ä½¿ç”¨ Python æ¨¡å— Mesa æ¥åˆ›å»º ABM æ¨¡å‹",
    "section": "2.1 åˆ›å»º Agent ç±»",
    "text": "2.1 åˆ›å»º Agent ç±»\nMesa ä¼šè‡ªåŠ¨ä¸ºæ¯ä¸ªåˆ›å»ºçš„ Agent åˆ†é…ä¸€ä¸ªæ•´æ•°ä½œä¸º unique_idã€‚\nä¸‹é¢è¿™æ®µä»£ç åˆ›å»ºäº†ä¸€ä¸ªæ–°ç±» (class) MoneyAgentï¼Œç»§æ‰¿äº† mesa.Agent ç±»çš„å±æ€§ã€‚\nmesa.Agent æ˜¯ Mesa æ¨¡å—ä¸­å®šä¹‰çš„ä¸€ä¸ªåŸºç±»ï¼Œæ‰€æœ‰çš„ Agent éƒ½åº”è¯¥ç»§æ‰¿è¿™ä¸ªç±»ã€‚\n\nclass MoneyAgent(mesa.Agent):\n    \"\"\"An agent with fixed initial wealth.\"\"\"\n    \n    # åˆå§‹åŒ–ï¼Œæ¯æ¬¡ä½¿ç”¨ MoneyAgent åˆ›å»ºæ–°å¯¹è±¡æ—¶éƒ½ä¼šä½¿ç”¨å¦‚ä¸‹åˆå§‹åŒ–\n    def __init__(self, model): # selfä»£è¡¨å½“å‰å¯¹è±¡ï¼Œmodel ä»£è¡¨æ¨¡å‹å¯¹è±¡\n      \n        # å°†çˆ¶ç±»ä¸­çš„å‚æ•° model (mesa.Agent) ä¼ å…¥ï¼Œè®©AgentçŸ¥é“è‡ªå·±æ‰€å±çš„æ¨¡å‹\n        super().__init__(model)\n\n        # åˆ›å»º Agent çš„å˜é‡ wealth å¹¶è®¾ç½®åˆå§‹å€¼\n        self.wealth = 1"
  },
  {
    "objectID": "index.html#åˆ›å»ºæ¨¡å‹ç±»",
    "href": "index.html#åˆ›å»ºæ¨¡å‹ç±»",
    "title": "åœ¨ R ä¸­ä½¿ç”¨ Python æ¨¡å— Mesa æ¥åˆ›å»º ABM æ¨¡å‹",
    "section": "2.2 åˆ›å»ºæ¨¡å‹ç±»",
    "text": "2.2 åˆ›å»ºæ¨¡å‹ç±»\nåˆ›å»ºä¸€ä¸ªæ¨¡å‹ç±»ï¼Œç»§æ‰¿è‡ª mesa.Modelï¼Œè´Ÿè´£åˆ›å»ºã€ä¿å­˜å’Œç®¡ç†æ‰€æœ‰ Agentã€‚\n\nclass MoneyModel(mesa.Model):\n    \"\"\"A model with some number of agents.\"\"\"\n\n    def __init__(self, n, seed=None): # n æ˜¯åˆ›å»ºçš„ Agent æ•°é‡ï¼Œseed æ˜¯éšæœºç§å­\n        super().__init__(seed=seed)\n        # åœ¨self (å³å½“å‰æ¨¡å‹) ä¸­åˆ›å»ºä¸€ä¸ªå±æ€§ num_agentsï¼Œä¿å­˜ Agent çš„æ•°é‡\n        self.num_agents = n \n        # è°ƒç”¨ç±»æ–¹æ³• create_agentsï¼Œåˆ›å»º n ä¸ª Agent\n        MoneyAgent.create_agents(model=self, n=n)"
  },
  {
    "objectID": "index.html#è®©-agents-do",
    "href": "index.html#è®©-agents-do",
    "title": "åœ¨ R ä¸­ä½¿ç”¨ Python æ¨¡å— Mesa æ¥åˆ›å»º ABM æ¨¡å‹",
    "section": "2.3 è®© Agents â€œdoâ€",
    "text": "2.3 è®© Agents â€œdoâ€\né€šè¿‡ do è®© ABM è¿è¡Œèµ·æ¥ï¼Œmesa ä¸­çš„ do å¯ä»¥æŒ‰ä¸åŒçš„é¡ºåºæ¿€æ´» Agentã€‚\nåœ¨æ¯ä¸€ä¸ª step ä¸­ï¼Œ(é€šå¸¸) æ¯ä¸€ä¸ª Agent éƒ½ä¼šè¢«æ¿€æ´»å¹¶é‡‡å–è‡ªå·±çš„è¡ŒåŠ¨ï¼Œåœ¨å†…éƒ¨å‘ç”Ÿå˜åŒ–å’Œ/æˆ–ä¸å½¼æ­¤æˆ–è€…ç¯å¢ƒäº¤äº’ã€‚\næ­¤å¤„ä½¿ç”¨ agent.shuffle_do() æ¥å®ç°éšæœºé‡æ–°æ’åºæ¿€æ´»é¡ºåºã€‚\n\nclass MoneyAgent(mesa.Agent):\n    \"\"\"An agent with fixed initial wealth.\"\"\"\n\n    def __init__(self, model):\n        super().__init__(model)\n        self.wealth = 1\n        # ä»¥ä¸Šä»£ç åŒä¸Š\n        \n        # å®šä¹‰ä¸€ä¸ªæ–¹æ³• say_hiï¼Œæ¯ä¸ª step ä¸­éƒ½ä¼šè¢«è°ƒç”¨\n    def say_hi(self):\n        # ä¸ºäº†æ¼”ç¤ºï¼Œè¾“å‡ºäº†æ¯ä¸ª Agent çš„ unique_id\n        print(f\"Hi, I am an agent, you can call me {str(self.unique_id)}.\")\n\n\nclass MoneyModel(mesa.Model):\n    \"\"\"A model with some number of agents.\"\"\"\n\n    def __init__(self, n, seed=None):\n        super().__init__(seed=seed)\n        self.num_agents = n\n\n        MoneyAgent.create_agents(model=self, n=n)\n        # ä»¥ä¸Šä»£ç åŒä¸Š\n\n    # å®šä¹‰æ¨¡å‹çš„ step æ–¹æ³•\n    def step(self):\n        \"\"\"Advance the model by one step.\"\"\"\n        \n        # éšæœºé‡æ–°æ’åº Agent çš„æ¿€æ´»é¡ºåºï¼Œå¹¶è°ƒç”¨æ¯ä¸ª Agent çš„ say_hi æ–¹æ³•\n        self.agents.shuffle_do(\"say_hi\")\n\n\n2.3.1 è¿è¡Œæ¨¡å‹\nåˆ›å»ºä¸€ä¸ªæ¨¡å‹å¯¹è±¡ (object) å¹¶è¿è¡Œå®ƒçš„ step æ–¹æ³•ã€‚\n\n# åˆ›å»ºæ¨¡å‹å¯¹è±¡ starter_modelï¼Œä½¿ç”¨ MoneyModel ç±»\n# æ­¤å¤„çš„ 10 å¯¹åº” MoneyModel ç±»çš„ç¬¬äºŒä¸ªå‚æ•° nï¼Œè¡¨ç¤ºåˆ›å»º 10 ä¸ª Agent\nstarter_model = MoneyModel(10)\n\n# è¿è¡Œæ¨¡å‹çš„ step æ–¹æ³•ï¼Œæ¿€æ´»æ‰€æœ‰ Agent\nstarter_model.step()\n\nHi, I am an agent, you can call me 6.\nHi, I am an agent, you can call me 10.\nHi, I am an agent, you can call me 8.\nHi, I am an agent, you can call me 2.\nHi, I am an agent, you can call me 9.\nHi, I am an agent, you can call me 1.\nHi, I am an agent, you can call me 4.\nHi, I am an agent, you can call me 7.\nHi, I am an agent, you can call me 3.\nHi, I am an agent, you can call me 5.\n\n\nå¦‚æœåœ¨åˆ›å»ºå¯¹è±¡æ—¶ä¼ å…¥äº† seed å‚æ•°ï¼Œåˆ™æ¯æ¬¡è¿è¡Œæ¨¡å‹æ—¶ Agent çš„é¡ºåºä¼šä¿æŒä¸€è‡´ã€‚\n\nstarter_model = MoneyModel(10, seed = 1234)\nstarter_model.step()\n\nHi, I am an agent, you can call me 3.\nHi, I am an agent, you can call me 9.\nHi, I am an agent, you can call me 4.\nHi, I am an agent, you can call me 6.\nHi, I am an agent, you can call me 7.\nHi, I am an agent, you can call me 5.\nHi, I am an agent, you can call me 10.\nHi, I am an agent, you can call me 1.\nHi, I am an agent, you can call me 2.\nHi, I am an agent, you can call me 8.\n\n\n\n\n2.3.2 æ¨¡å‹ä¿®æ”¹ç»ƒä¹ \nåœ¨åŸæœ‰æ¨¡å‹çš„åŸºç¡€ä¸Šï¼Œè®© Agent åœ¨æ¿€æ´»æ—¶è¾“å‡ºè‡ªå·±çš„ wealthã€‚\n\nclass MoneyAgent(mesa.Agent):\n    \"\"\"An agent with fixed initial wealth.\"\"\"\n\n    def __init__(self, model):\n        super().__init__(model)\n\n        self.wealth = 1\n\n    # å®šä¹‰ say_wealth æ–¹æ³•ï¼Œè¾“å‡º Agent çš„ wealth\n    def say_wealth(self):\n        print(f\"Hi, I am an agent {self.unique_id},\"\n              f\"and I have {self.wealth} dollars.\")\n        \nclass MoneyModel(mesa.Model):\n    \"\"\"A model with some number of agents.\"\"\"\n\n    def __init__(self, n, seed=None):\n        super().__init__(seed=seed)\n        self.num_agents = n\n\n        MoneyAgent.create_agents(model=self, n=n)\n\n    def step(self):\n        \"\"\"Advance the model by one step.\"\"\"\n        \n        self.agents.shuffle_do(\"say_wealth\")\n        \nstarter_model = MoneyModel(10)\nstarter_model.step()\n\nHi, I am an agent 6,and I have 1 dollars.\nHi, I am an agent 9,and I have 1 dollars.\nHi, I am an agent 2,and I have 1 dollars.\nHi, I am an agent 8,and I have 1 dollars.\nHi, I am an agent 1,and I have 1 dollars.\nHi, I am an agent 5,and I have 1 dollars.\nHi, I am an agent 3,and I have 1 dollars.\nHi, I am an agent 10,and I have 1 dollars.\nHi, I am an agent 4,and I have 1 dollars.\nHi, I am an agent 7,and I have 1 dollars."
  },
  {
    "objectID": "index.html#agents-äº¤æ¢è´¢å¯Œ",
    "href": "index.html#agents-äº¤æ¢è´¢å¯Œ",
    "title": "åœ¨ R ä¸­ä½¿ç”¨ Python æ¨¡å— Mesa æ¥åˆ›å»º ABM æ¨¡å‹",
    "section": "2.4 Agents äº¤æ¢è´¢å¯Œ",
    "text": "2.4 Agents äº¤æ¢è´¢å¯Œ\n\nclass MoneyAgent(mesa.Agent):\n    \"\"\"An agent with fixed initial wealth.\"\"\"\n\n    def __init__(self, model):\n        super().__init__(model)\n        self.wealth = 1\n        \n    # å®šä¹‰ exchange æ–¹æ³•ï¼Œè®© Agent äº¤æ¢è´¢å¯Œ\n    def exchange(self):\n        if self.wealth &gt; 0: # æœ‰é’±æ‰èƒ½è½¬è´¦\n            # self.random, æ˜¯ç»§æ‰¿è‡ª mesa.Agent çš„éšæœºæ•°ç”Ÿæˆå™¨\n            # .choice(...) åœ¨åˆ—è¡¨ä¸­éšæœºé€‰æ‹©ä¸€ä¸ª Agent\n            # è¿™é‡Œçš„self.modelæ˜¯åœ¨ä¸Šä¸€æ­¥â€”__init__ä¸­ä¼ å…¥çš„æ¨¡å‹å¯¹è±¡\n            other_agent = self.random.choice(self.model.agents)\n            \n            if other_agent is not None: # ç¡®ä¿é€‰åˆ°äº†ä¸€ä¸ª Agent\n                other_agent.wealth += 1\n                self.wealth -= 1\n\n\nclass MoneyModel(mesa.Model):\n    \"\"\"A model with some number of agents.\"\"\"\n\n    def __init__(self, n, seed=None):\n        super().__init__(seed = seed)\n        self.num_agents = n\n\n        MoneyAgent.create_agents(model=self, n=n)\n\n    def step(self):\n        \"\"\"Advance the model by one step.\"\"\"\n\n        self.agents.shuffle_do(\"exchange\")\n\n\n2.4.1 è¿è¡Œæ¨¡å‹\n\nmodel = MoneyModel(10, 1234)  # åˆ›å»º 10 ä¸ª Agents\n\n# è¿™ä¸ª for å¾ªç¯ä¸­ _ æ˜¯ä¸€ä¸ªå ä½ç¬¦\n# è¡¨ç¤ºæˆ‘ä»¬ä¸å…³å¿ƒå¾ªç¯å˜é‡çš„å€¼ï¼Œä¹Ÿä¸å…³å¿ƒç°åœ¨è¿è¡Œäº†å‡ æ¬¡ï¼Œåªæ˜¯æƒ³è¿è¡Œ30æ¬¡\nfor _ in range(30): \n    model.step()\n\n\n\n2.4.2 å¯è§†åŒ–\n\n# è·å–æ¯ä¸ª Agent çš„ wealthï¼Œæ”¾å…¥ä¸€ä¸ªåˆ—è¡¨\nagent_wealth = [a.wealth for a in model.agents]\n# ç»˜åˆ¶ç›´æ–¹å›¾\ng = sns.histplot(agent_wealth, discrete=True)\ng.set(\n    title=\"Wealth distribution\", xlabel=\"Wealth\", ylabel=\"number of agents\"\n);\nplt.show()\n\n\n\n\n\n\n\n\n\n2.4.2.1 ä¼ å…¥ R ä¸­ç”¨ ggplot2 å¯è§†åŒ–\n\nlibrary(tidyverse)\n\nâ”€â”€ Attaching core tidyverse packages â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ tidyverse 2.0.0 â”€â”€\nâœ” dplyr     1.1.4     âœ” readr     2.1.5\nâœ” forcats   1.0.0     âœ” stringr   1.5.1\nâœ” ggplot2   3.5.2     âœ” tibble    3.3.0\nâœ” lubridate 1.9.4     âœ” tidyr     1.3.1\nâœ” purrr     1.0.4     \nâ”€â”€ Conflicts â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ tidyverse_conflicts() â”€â”€\nâœ– dplyr::filter() masks stats::filter()\nâœ– dplyr::lag()    masks stats::lag()\nâ„¹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors\n\n# ä½¿ç”¨ iterate å‡½æ•°éå† model ä¸­çš„ agents\nagent_wealth &lt;- map_dbl(iterate(py$model$agents), \"wealth\") %&gt;% \n  tibble(wealth = .)\n\nggplot(agent_wealth, aes(x = wealth)) +\n  geom_histogram(binwidth = 1, boundary = 0, closed = \"left\",\n                 color = \"black\", fill=\"red\") +\n  labs(\n    title = \"Wealth distribution\",\n    x     = \"Wealth\",\n    y     = \"Number of agents\"\n  )+ theme_bw()\n\n\n\n\n\n\n\n\n\n\n\n2.4.3 åˆ›å»ºå¤šä¸ªæ¨¡å‹å¯¹è±¡\nä¸ºäº†æ›´å¥½åœ°ç†è§£æ¨¡å‹è¡Œä¸ºï¼Œå¯ä»¥åˆ›å»ºå¤šä¸ªæ¨¡å‹å¯¹è±¡ï¼Œä»¥è§‚å¯Ÿæ•´ä½“åˆ†å¸ƒã€‚\n\n# åˆ›å»ºä¸€ä¸ªç©ºåˆ—è¡¨æ¥å­˜å‚¨å¾ªç¯ç»“æœï¼Œä¸ R ä¸­ç±»ä¼¼ï¼Œå¯ä»¥ä½¿å¾ªç¯è¿è¡Œæ›´å¿«\nall_wealth = []\n# è¿è¡Œ 100 æ¬¡æ¨¡å‹ï¼Œæ¯ä¸ªæ¨¡å‹æœ‰ 10 ä¸ª Agentï¼Œå¹¶è¿è¡Œ 30 æ¬¡ step\nfor _ in range(100):\n    model = MoneyModel(10)\n    for _ in range(30):\n        model.step()\n    # æ³¨æ„è¿™é‡Œçš„ç¼©è¿›ï¼Œè¯´æ˜ä¸‹é¢è¿™ä¸ªå¾ªç¯æ˜¯åœ¨for _ in range(100):å¾ªç¯ä¸­\n    # è¿™æ ·æ¯æ¬¡è¿è¡Œä¸€ä¸ªæ¨¡å‹å°±ä¼šå­˜å‚¨æ‰€æœ‰ Agent çš„ wealth\n    for agent in model.agents:\n        # æ³¨æ„è¿™é‡Œä½¿ç”¨äº†å°±åœ°æ‰©å±• (append), å³ç›´æ¥å‘ all_wealth åˆ—è¡¨æ·»åŠ å…ƒç´ \n        # è¿™æ˜¯pythonçš„ä¸€ä¸ªç‰¹æ€§ï¼Œç›´æ¥åœ¨liståå¢åŠ å…ƒç´ ä¸æ˜¯ä¸€ä¸ªå¤æ‚çš„è®¡ç®—\n        all_wealth.append(agent.wealth)\n        \ng = sns.histplot(all_wealth, discrete=True)\ng.set(title=\"Wealth distribution\", xlabel=\"Wealth\", ylabel=\"number of agents\");\nplt.show()\n\n\n\n\n\n\n\n\n\n2.4.3.1 åœ¨ R ä¸­è¿è¡Œæ¨¡å‹\n\nmodels &lt;- map(1L:100L, ~{\n  model &lt;- py$MoneyModel(10L)\n  walk(1L:30L, ~ model$step())\n  model\n})\n\nall_wealth &lt;- map_dfr(models, \n                      ~map_dbl(iterate(.x$agents), \"wealth\") %&gt;% \n                        tibble(wealth = .))\n\nggplot(all_wealth, aes(x = wealth)) +\n  geom_histogram(binwidth = 1, boundary = 0, closed = \"left\",\n                 color = \"black\", fill=\"red\") +\n  labs(\n    title = \"Wealth distribution\",\n    x     = \"Wealth\",\n    y     = \"Number of agents\"\n  )+ theme_bw()"
  },
  {
    "objectID": "index.html#åŸºç¡€æ¨¡å‹",
    "href": "index.html#åŸºç¡€æ¨¡å‹",
    "title": "åœ¨ R ä¸­ä½¿ç”¨ Python æ¨¡å— Mesa æ¥åˆ›å»º ABM æ¨¡å‹",
    "section": "3.1 åŸºç¡€æ¨¡å‹",
    "text": "3.1 åŸºç¡€æ¨¡å‹\nä»¥ä¸‹æ¨¡å‹å³ä¸Šè¿°è´¢å¯Œæ¨¡å‹ã€‚\n\nclass MoneyAgent(mesa.Agent):\n    \"\"\"An agent with fixed initial wealth.\"\"\"\n\n    def __init__(self, model):\n        super().__init__(model)\n        self.wealth = 1\n\n    def exchange(self):\n        if self.wealth &gt; 0:\n            other_agent = self.random.choice(self.model.agents)\n            if other_agent is not None:\n                other_agent.wealth += 1\n                self.wealth -= 1\n\n\nclass MoneyModel(mesa.Model):\n    \"\"\"A model with some number of agents.\"\"\"\n\n    def __init__(self, n):\n        super().__init__()\n        self.num_agents = n\n        MoneyAgent.create_agents(model=self, n=n)\n\n    def step(self):\n        \"\"\"Advance the model by one step.\"\"\"\n        self.agents.shuffle_do(\"exchange\")\n\n\nmodel = MoneyModel(10)\nmodel.step()\n\nprint(f\"You have {len(model.agents)} agents.\")\n\nYou have 10 agents."
  },
  {
    "objectID": "index.html#ç©ºé—´æ¦‚å¿µ",
    "href": "index.html#ç©ºé—´æ¦‚å¿µ",
    "title": "åœ¨ R ä¸­ä½¿ç”¨ Python æ¨¡å— Mesa æ¥åˆ›å»º ABM æ¨¡å‹",
    "section": "3.2 ç©ºé—´æ¦‚å¿µ",
    "text": "3.2 ç©ºé—´æ¦‚å¿µ\nMesa æä¾›ä¸¤ç§ç©ºé—´ç±»å‹ï¼šç¦»æ•£ç©ºé—´å’Œè¿ç»­ç©ºé—´ã€‚\n\nç¦»æ•£ç©ºé—´ï¼šAgent å æ®å•å…ƒæ ¼æˆ–èŠ‚ç‚¹\nè¿ç»­ç©ºé—´ï¼šAgent å æ®ä¸‰ç»´ç©ºé—´ä¸­çš„ä»»ä½•ä½ç½®\n\nä»¥ä¸‹ä½¿ç”¨ç»å…¸ç¬›å¡å°”åæ ‡ç³»ä¸‹çš„ç¦»æ•£ç©ºé—´ï¼Œå…·æœ‰ä¸¤ä¸ªæ¨¡å—ï¼šå•å…ƒæ ¼ (cell) å’Œå•å…ƒæ ¼ Agentã€‚\nå•å…ƒæ ¼ç±»è¡¨ç¤ºä¸€ä¸ªå…·å¤‡ä»¥ä¸‹åŠŸèƒ½çš„ä½ç½®ï¼š\n\nå…·æœ‰å±æ€§ (å¦‚æ¸©åº¦ã€èµ„æºç­‰)\nè¿½è¸ªå¹¶é™åˆ¶å…¶åŒ…å«çš„ Agent\nä¸ç›¸é‚»å•å…ƒæ ¼è¿æ¥\næä¾›é‚»å±… (neighborhood) çš„ä¿¡æ¯\n\nå•å…ƒæ ¼ Agent ç±»ï¼šèƒ½å¤Ÿç†è§£å¦‚ä½•åœ¨å•å…ƒæ ¼ä¸­å­˜åœ¨å’Œç§»åŠ¨çš„ Agentã€‚\n\nCellAgent: å¯ä»¥åœ¨å•å…ƒæ ¼é—´ç§»åŠ¨çš„ Agentã€‚\nFixedAgent: æ°¸ä¹…å›ºå®šåœ¨å•å…ƒæ ¼ä¸Šçš„é™æ­¢ Agentã€‚\nGrid2DMovingAgent: å…·æœ‰ç‰¹å®šç½‘æ ¼ç§»åŠ¨èƒ½åŠ›çš„ Agentã€‚\n\n\n\n\nDiscrete Space\n\n\n\nç½‘æ ¼ (Grid): è§„åˆ™å¤šè¾¹å½¢\n\næ‘©å°”é‚»åŸŸ (Moore Grid)ï¼šæ¯ä¸ªå•å…ƒæ ¼çš„å…«ä¸ªç›¸é‚»å•å…ƒæ ¼ã€‚\nå†¯è¯ºä¾æ›¼é‚»åŸŸ (Von Neumann Grid)ï¼šæ¯ä¸ªå•å…ƒæ ¼çš„å››ä¸ªç›¸é‚»å•å…ƒæ ¼ã€‚\nå…­è¾¹å½¢ (Hex Grid)ï¼šæ¯ä¸ªå•å…ƒæ ¼çš„å…­ä¸ªç›¸é‚»å•å…ƒæ ¼ã€‚\n\nç½‘ç»œ (Network): æ¯ä¸ªæ ¼ç‚¹æ˜¯å›¾ä¸­çš„ä¸€ä¸ªèŠ‚ç‚¹ï¼Œè¿æ¥å…³ç³»ç”±è¾¹ï¼ˆedgeï¼‰å®šä¹‰ï¼Œé€‚åˆç¤¾äº¤ç½‘ç»œã€é€šä¿¡æ‹“æ‰‘ç­‰åœºæ™¯ã€‚\n\n\n\n\nNetwork\n\n\n\nVoronoi: ä¸è§„åˆ™å¤šè¾¹å½¢åˆ’åˆ†ç©ºé—´ï¼šç»™å®šä¸€ç»„ä¸­å¿ƒç‚¹ï¼Œæ¯å—å¤šè¾¹å½¢å°±æ˜¯ä¸€ä¸ª Cellï¼Œé€‚ç”¨äºåœ°ç†ç©ºé—´ç­‰ä¸è§„åˆ™ç½‘æ ¼æƒ…å½¢ã€‚\n\n\n\n\nVoronoi"
  },
  {
    "objectID": "index.html#ä»£ç å®ç°",
    "href": "index.html#ä»£ç å®ç°",
    "title": "åœ¨ R ä¸­ä½¿ç”¨ Python æ¨¡å— Mesa æ¥åˆ›å»º ABM æ¨¡å‹",
    "section": "3.3 ä»£ç å®ç°",
    "text": "3.3 ä»£ç å®ç°\n\n3.3.1 åˆ›å»º CellAgent\nä¸ºäº†ä½¿æ¨¡å‹å…·æœ‰ç¦»æ•£ç©ºé—´åŠŸèƒ½ï¼Œæˆ‘ä»¬å°† MoneyAgent å®ä¾‹åŒ–ä¸º CellAgentã€‚\nCellAgent æ˜¯ Agent çš„ä¸€ä¸ªå­ç±»ï¼Œä¸“é—¨ç”¨äºåœ¨ç¦»æ•£ç©ºé—´ discrete space æ¨¡å—ä¸­äº¤äº’å’Œç§»åŠ¨ã€‚\n\n# ä¸‹é¢è¿™è¡Œimportç›¸å½“äºåªä» mesa.discrete_space ä¸­å¯¼å…¥\n# CellAgent å’Œ OrthogonalMooreGrid è¿™ä¸¤ä¸ªç±»ï¼Œå¦‚æœæ­¤å¤„å¯¼å…¥\n# é‚£ä¹ˆä¸‹é¢ä½¿ç”¨æ—¶ä¸éœ€è¦å†™æ˜ mesa.discrete_space.CellAgent\n# è€Œå¯ä»¥ç›´æ¥ä½¿ç”¨CellAgentï¼Œç±»ä¼¼Rä¸­ dplyr::select å’Œ library(dplyr)\n# from mesa.discrete_space import CellAgent, OrthogonalMooreGrid\n\n# ä½¿ç”¨çˆ¶ç±» CellAgent æ¥åˆ›å»ºä¸€ä¸ªæ–°çš„ Agent ç±» MoneyAgent\nclass MoneyAgent(mesa.discrete_space.CellAgent):\n    \"\"\"An agent with fixed initial wealth.\"\"\"\n\n    def __init__(self, model, cell): \n        super().__init__(model)\n        self.cell = cell  # å°† Agent åˆå§‹åŒ–åœ¨ (x,y)ï¼Œè¿™ä¸ªä½ç½®ç”±å‚æ•° cell å†³å®š\n        self.wealth = 1\n\n    # å®šä¹‰ç§»åŠ¨å‡½æ•°ï¼Œæ§åˆ¶ Agent åœ¨å•å…ƒæ ¼ä¸­ç§»åŠ¨\n    def move(self):\n        # é€‰æ‹©ä¸€ä¸ªéšæœºçš„ç›¸é‚»å•å…ƒæ ¼ï¼Œé»˜è®¤åŠå¾„ä¸º 1\n        self.cell = self.cell.neighborhood.select_random_cell()\n    \n    # å®šä¹‰äº¤æ¢è´¢å¯Œå‡½æ•°\n    def give_money(self):\n        # é€‰æ‹©åŒä¸€ä¸ªå•å…ƒæ ¼å†…æ‰€æœ‰éæœ¬èº«çš„ Agent\n        cellmates = [\n            a for a in self.cell.agents if a is not self\n        ] \n        # å¦‚æœè‡ªå·±çš„è´¢å¯Œ &gt;0, åˆ‡å­˜åœ¨åŒæ ¼å†…çš„å…¶ä»– Agent\n        if self.wealth &gt; 0 and cellmates:\n            # åœ¨æ‰€æœ‰åŒæ ¼å†…çš„ Agent ä¸­éšæœºé€‰æ‹©ä¸€ä¸ª\n            other_agent = self.random.choice(cellmates)\n            # å°†è‡ªå·±çš„è´¢å¯Œ -1ï¼Œé€‰ä¸­çš„ Agent çš„è´¢å¯Œ +1\n            other_agent.wealth += 1\n            self.wealth -= 1\n\n\n\n3.3.2 åˆ›å»ºæ¨¡å‹ç±»\n\nclass MoneyModel(mesa.Model):\n    \"\"\"A model with some number of agents.\"\"\"\n\n    def __init__(self, n, width, height, seed=None):\n        super().__init__(seed=seed)\n        self.num_agents = n\n        # åˆ›å»ºä¸€ä¸ªæ‘©å°”é‚»åŸŸ (æ¯ä¸ªå•å…ƒæ ¼æœ‰ 4 ä¸ªé‚»å±…) ç½‘æ ¼\n        self.grid = mesa.discrete_space.OrthogonalMooreGrid(\n            # é•¿å®½å‚æ•°ç”±å¤–éƒ¨ä¼ å…¥ï¼Œtorusæ§åˆ¶å¯ç”¨å‘¨æœŸæ€§è¾¹ç•Œ\n            # å³æœ€å³è¾¹å’Œæœ€å·¦è¾¹ç›¸æ¥ï¼Œä¸Šä¸‹ç›¸æ¥\n            # æ¯ä¸ªå•å…ƒæ ¼æœ€å¤§å¯ä»¥å®¹çº³ 10 ä¸ª Agent\n            (width, height), torus=True, capacity=10, random=self.random\n        )\n\n        # åˆ›å»º Agentï¼Œè¿™é‡Œå’Œå‰é¢çš„æ¨¡å‹ä¸ä¸€æ ·ï¼Œæ–°å»ºçš„ Agent è¢«å­˜å…¥äº†åˆ—è¡¨ agents\n        # å› ä¸ºç«‹åˆ»è¦å¯¹ agents è¿›è¡Œæ“ä½œï¼Œè¦å°†å…¶ä¿å­˜\n        # å¦‚æœç›´æ¥è°ƒç”¨ create_agentsï¼Œæ¨¡å‹ä¸­å­˜åœ¨çš„æ˜¯æ—§çš„+æ–°å»ºçš„ agents\n        # å¦‚ä¸‹å†™ï¼Œæ¯æ¬¡éƒ½ä¼šè¦†ç›– agents\n        agents = MoneyAgent.create_agents(\n            self, # model = self\n            self.num_agents, # n = self.num_agents\n            # ç»™æ¯ä¸ª Agent åˆ†é…ä¸€ä¸ªéšæœºçš„å•å…ƒæ ¼\n            # ä»æ‰€æœ‰å•å…ƒæ ¼ä¸­æŒ‘ k æ¬¡ï¼Œk = Agent çš„æ•°é‡\n            self.random.choices(self.grid.all_cells.cells, k=self.num_agents),\n        )\n    \n    # å®šä¹‰ stepï¼Œæ¯æ­¥è¿è¡Œä¸€æ¬¡ç§»åŠ¨å’Œä¸€æ¬¡ç»™é’±\n    def step(self):\n        self.agents.shuffle_do(\"move\")\n        self.agents.do(\"give_money\")\n\n\n\n3.3.3 è¿è¡Œæ¨¡å‹\nåœ¨ä¸€ä¸ª 10x10 çš„ç½‘æ ¼ä¸Šåˆ›å»ºä¸€ä¸ªåŒ…å« 100 ä¸ªæ™ºèƒ½ä½“çš„æ¨¡å‹ï¼Œå¹¶è¿è¡Œ 20 æ­¥ã€‚\n\nmodel = MoneyModel(100, 10, 10, 1234)\nfor _ in range(20):\n    model.step()\n\n\n\n3.3.4 å¯è§†åŒ–\n\nagent_counts = np.zeros((model.grid.width, model.grid.height))\n\nfor cell in model.grid.all_cells:\n    agent_counts[cell.coordinate] = len(cell.agents)\n\ng = sns.heatmap(agent_counts, cmap=\"viridis\", annot=True, cbar=False, square=True)\ng.figure.set_size_inches(5, 5)\ng.set(title=\"Number of agents on each cell of the grid\");\nplt.show()\n\n\n\n\n\n\n\n\n\n3.3.4.1 ç”¨ R è¿è¡Œæ¨¡å‹\nä½¿ç”¨ ggplot2 æ‰‹åŠ¨ç»˜åˆ¶ã€‚\n\nlibrary(tidyverse)\n\nmodel = py$MoneyModel(100L, 10L, 10L, 1234L)\nwalk(1:20L, ~model$step())\n\nagent_counts &lt;- map_dfr(\n  iterate(model$grid$all_cells),\n  ~{\n    coord &lt;- as.numeric(.x$coordinate)\n    tibble(\n      col   = coord[1],\n      row   = coord[2],\n      count = length(.x$agents)\n    )\n  }\n)\n\nggplot(agent_counts,aes(col, row, fill = count, label = count)) +\n  geom_tile() +\n  geom_text(color = \"white\") +\n  scale_fill_viridis_c(option = \"viridis\") + \n  scale_x_continuous(breaks = seq(min(agent_counts$col),\n                                  max(agent_counts$col), by = 1),\n                     expand = c(0,0)) +\n  scale_y_reverse(breaks = seq(min(agent_counts$row),\n                               max(agent_counts$row), by = 1),\n                     expand = c(0,0)) +\n  coord_fixed() + \n  theme_minimal() +\n  ggtitle(\"Number of agents on each cell of the grid\") +\n  theme(\n    legend.position = \"none\",\n    plot.title = element_text(hjust = 0.5)\n  ) +\n  labs(x = NULL, y = NULL)\n\n\n\n\n\n\n\n\næˆ–è€…è°ƒç”¨ä¸€äº›æ›´æ–¹ä¾¿çš„åŒ…ï¼Œå¦‚ tidyheatmapsã€‚\n\nlibrary(tidyheatmaps)\ntidyheatmap(agent_counts, row, col, count, colors = viridis::viridis(100),\n            display_numbers = T, number_format = \"%.0f\", number_color = \"white\",\n            fontsize_number = 10,legend = F,cellwidth = 30, cellheigh = 30,\n            angle_col = 0,\n            main = \"Number of agents on each cell of the grid\")\n\n\n\n\n\n\n\n\n\n\n\n3.3.5 æ¨¡å‹ä¿®æ”¹ç»ƒä¹ \n\n3.3.5.1 æ”¹å˜ç½‘æ ¼å°ºå¯¸\nå°†ç½‘æ ¼å°ºå¯¸ä» 10x10 æ”¹ä¸º 20x20ï¼Œå¹¶è¿è¡Œæ¨¡å‹ã€‚\n\nmodel = py$MoneyModel(100L, 20L, 20L, 1234L)\nwalk(1:20L, ~model$step())\n\nagent_counts &lt;- map_dfr(\n  iterate(model$grid$all_cells),\n  ~{\n    coord &lt;- as.numeric(.x$coordinate)\n    tibble(\n      col   = coord[1],\n      row   = coord[2],\n      count = length(.x$agents)\n    )\n  }\n)\n\ntidyheatmap(agent_counts, row, col, count, colors = viridis::viridis(100),\n            display_numbers = T, number_format = \"%.0f\", number_color = \"white\",\n            fontsize_number = 10,legend = F,cellwidth = 15, cellheigh = 15,\n            angle_col = 0,\n            main = \"Number of agents on each cell of the grid\")\n\n\n\n\n\n\n\n\n\n\n3.3.5.2 æ”¹å˜å•å…ƒæ ¼å®¹é‡\nå°†å•å…ƒæ ¼å®¹é‡ä» 10 æ”¹ä¸º 3ï¼Œå¹¶è¿è¡Œæ¨¡å‹ã€‚\n\nmodel = py$MoneyModel(100L, 10L, 10L, 1234L)\nmodel$grid$capacity = 3L\nwalk(1:20L, ~model$step())\n\nagent_counts &lt;- map_dfr(\n  iterate(model$grid$all_cells),\n  ~{\n    coord &lt;- as.numeric(.x$coordinate)\n    tibble(\n      col   = coord[1],\n      row   = coord[2],\n      count = length(.x$agents)\n    )\n  }\n)\n\ntidyheatmap(agent_counts, row, col, count, colors = viridis::viridis(100),\n            display_numbers = T, number_format = \"%.0f\", number_color = \"white\",\n            fontsize_number = 10,legend = F,cellwidth = 30, cellheigh = 30,\n            angle_col = 0,\n            main = \"Number of agents on each cell of the grid\")\n\n\n\n\n\n\n\n\n\n\n3.3.5.3 æ”¹ä¸ºæ­£äº¤å†¯è¯ºä¾æ›¼\nå°†ç½‘æ ¼ä»æ‘©å°”é‚»åŸŸæ”¹ä¸ºæ­£äº¤å†¯è¯ºä¾æ›¼é‚»åŸŸã€‚\n\nclass MoneyModel(mesa.Model):\n    \"\"\"A model with some number of agents.\"\"\"\n\n    def __init__(self, n, width, height, seed=None):\n        super().__init__(seed=seed)\n        self.num_agents = n\n        self.grid = mesa.discrete_space.OrthogonalVonNeumannGrid(\n            (width, height), torus=True, capacity=10, random=self.random\n        )\n\n        agents = MoneyAgent.create_agents(\n            self,\n            self.num_agents,\n            self.random.choices(self.grid.all_cells.cells, k=self.num_agents),\n        )\n\n    def step(self):\n        self.agents.shuffle_do(\"move\")\n        self.agents.do(\"give_money\")\n\n\nmodel = py$MoneyModel(100L, 10L, 10L, 1234L)\nwalk(1:20L, ~model$step())\n\nagent_wealth &lt;- map_dbl(iterate(py$model$agents), \"wealth\") %&gt;% \n  tibble(wealth = .)\n\nggplot(agent_wealth, aes(x = wealth)) +\n  geom_histogram(binwidth = 1, boundary = 0, closed = \"left\",\n                 color = \"black\", fill=\"red\") +\n  labs(\n    title = \"Wealth distribution\",\n    x     = \"Wealth\",\n    y     = \"Number of agents\"\n  )+ theme_bw()"
  },
  {
    "objectID": "index.html#åˆ›å»º-model-level-æ•°æ®æ”¶é›†",
    "href": "index.html#åˆ›å»º-model-level-æ•°æ®æ”¶é›†",
    "title": "åœ¨ R ä¸­ä½¿ç”¨ Python æ¨¡å— Mesa æ¥åˆ›å»º ABM æ¨¡å‹",
    "section": "5.1 åˆ›å»º model-level æ•°æ®æ”¶é›†",
    "text": "5.1 åˆ›å»º model-level æ•°æ®æ”¶é›†\n\nfrom mesa.discrete_space import CellAgent, OrthogonalMooreGrid\ndef compute_gini(model):\n  agent_wealth = [agent.wealth for agent in model.agents]\n  x = sorted(agent_wealth)\n  n = model.num_agents\n  # è®¡ç®—åŸºå°¼ç³»æ•°\n  B = sum(xi * (n - i) for i, xi in enumerate(x)) / sum(x)\n  # !!!æ³¨æ„è¿™é‡Œï¼Œpythonä¸ä¼šè‡ªåŠ¨è¿”å›æœ€åä¸€ä¸ªå€¼ï¼Œå¿…é¡»æ˜¾å¼è¿”å›\n  return 1 + (1 / n) - 2 * B\n\nclass MoneyAgent(CellAgent):\n  def __init__(self, model, cell):\n    super().__init__(model)\n    self.cell = cell\n    self.wealth = 1\n  def move(self):\n    self.cell = self.cell.neighborhood.select_random_cell()\n  def give_money(self):\n    cellmates = [a for a in self.cell.agents if a is not self]\n    if self.wealth &gt; 0 and cellmates:\n      other_agent = self.random.choice(cellmates)\n      other_agent.wealth += 1\n      self.wealth -= 1\n\nclass MoneyModel(mesa.Model):\n  def __init__(self, n, width, height, seed = None):\n    super().__init__(seed = seed)\n    self.num_agents = n\n    self.grid = OrthogonalMooreGrid(\n        (width, height), torus=True, capacity=10, random=self.random\n    )\n    # å®ä¾‹åŒ–æ•°æ®æ”¶é›†å™¨ (DataCollector)\n    self.datacollector = mesa.DataCollector(\n      model_reporters = {\"Gini\": compute_gini}, \n      agent_reporters = {\"Wealth\": \"wealth\"}\n    )\n    agents = MoneyAgent.create_agents(\n      self,\n      self.num_agents,\n      self.random.choices(self.grid.all_cells.cells, k = self.num_agents)\n    )\n  def step(self):\n    # åœ¨æ¯ä¸ª step ä¸­æ”¶é›†æ•°æ®\n    self.datacollector.collect(self)\n    self.agents.shuffle_do(\"move\")\n    self.agents.do(\"give_money\")"
  },
  {
    "objectID": "index.html#è·å–-model_level-æ•°æ®",
    "href": "index.html#è·å–-model_level-æ•°æ®",
    "title": "åœ¨ R ä¸­ä½¿ç”¨ Python æ¨¡å— Mesa æ¥åˆ›å»º ABM æ¨¡å‹",
    "section": "5.2 è·å– model_level æ•°æ®",
    "text": "5.2 è·å– model_level æ•°æ®\n\nmodel = MoneyModel(100, 10, 10, 1234)\nfor _ in range(100):\n    model.step()\n\ngini = model.datacollector.get_model_vars_dataframe()\ng = sns.lineplot(data=gini)\ng.set(title=\"Gini Coefficient over Time\", ylabel=\"Gini Coefficient\");\nplt.show()\n\n\n\n\n\n\n\n\n\n5.2.1 åœ¨ R ä¸­è¿è¡Œæ¨¡å‹\n\nmodel = py$MoneyModel(100L, 10L, 10L, 1234L)\nwalk(1:100L, ~model$step())\n\n# å¯ä»¥ç›´æ¥è¿™æ ·è°ƒç”¨ python çš„ function\ngini = model$datacollector$get_model_vars_dataframe()  %&gt;%  \n  rownames_to_column(\"step\") %&gt;% mutate(step = as.numeric(step))\ngini %&gt;% \n  ggplot(aes(x = step, y = Gini)) +\n  geom_line(color = \"steelblue\") +\n  labs(\n    title = \"Gini Coefficient over Time\",\n    x     = \"Step\",\n    y     = \"Gini Coefficient\"\n  ) + theme_bw()"
  },
  {
    "objectID": "index.html#ç»ƒä¹ ",
    "href": "index.html#ç»ƒä¹ ",
    "title": "åœ¨ R ä¸­ä½¿ç”¨ Python æ¨¡å— Mesa æ¥åˆ›å»º ABM æ¨¡å‹",
    "section": "5.3 ç»ƒä¹ ",
    "text": "5.3 ç»ƒä¹ \n\n5.3.1 ä»…æ˜¾ç¤ºæ•°æ®ä»¥æŸ¥çœ‹æ ¼å¼\n\npy$gini %&gt;% \n  rownames_to_column(\"step\") %&gt;% \n  mutate(step = as.numeric(step)) %&gt;% \n  head(6)\n\n  step   Gini\n1    1 -99.99\n2    2 -92.31\n3    3 -85.27\n4    4 -73.97\n5    5 -66.97\n6    6 -62.53\n\n\n\n\n5.3.2 å¢åŠ  Agent çš„æ•°é‡å’Œæ—¶é—´\n\n5.3.2.1 å¢åŠ æ•°é‡\n\nmodel = py$MoneyModel(400L, 20L, 20L, 1234L)\nwalk(1:100L, ~model$step())\n\ngini_r = model$datacollector$get_model_vars_dataframe()  %&gt;%  \n  rownames_to_column(\"step\") %&gt;% mutate(step = as.numeric(step))\ngini_r %&gt;% \n  ggplot(aes(x = step, y = Gini)) +\n  geom_line() +\n  labs(\n    title = \"Gini Coefficient over Time\",\n    x     = \"Step\",\n    y     = \"Gini Coefficient\"\n  ) + theme_bw()\n\n\n\n\n\n\n\n\n\n\n5.3.2.2 å¢åŠ æ—¶é—´\n\nmodel = py$MoneyModel(100L, 10L, 10L, 1234L)\nwalk(1:1000L, ~model$step())\n\ngini_r = model$datacollector$get_model_vars_dataframe()  %&gt;%  \n  rownames_to_column(\"step\") %&gt;% mutate(step = as.numeric(step))\ngini_r %&gt;% \n  ggplot(aes(x = step, y = Gini)) +\n  geom_line() +\n  labs(\n    title = \"Gini Coefficient over Time\",\n    x     = \"Step\",\n    y     = \"Gini Coefficient\"\n  ) + theme_bw()"
  },
  {
    "objectID": "index.html#è·å–-agent_level-æ•°æ®",
    "href": "index.html#è·å–-agent_level-æ•°æ®",
    "title": "åœ¨ R ä¸­ä½¿ç”¨ Python æ¨¡å— Mesa æ¥åˆ›å»º ABM æ¨¡å‹",
    "section": "5.4 è·å– agent_level æ•°æ®",
    "text": "5.4 è·å– agent_level æ•°æ®\nç»˜åˆ¶æ¯ä¸ª Agent åœ¨æœ€åä¸€æ­¥çš„è´¢å¯Œåˆ†å¸ƒã€‚\n\nagent_wealth = model.datacollector.get_agent_vars_dataframe()\nagent_wealth.head()\n\n              Wealth\nStep AgentID        \n1    1             1\n     2             1\n     3             1\n     4             1\n     5             1\n\nlast_step = agent_wealth.index.get_level_values(\"Step\").max()\nend_wealth = agent_wealth.xs(last_step, level=\"Step\")[\n    \"Wealth\"\n]\n\ng = sns.histplot(end_wealth, discrete=True)\ng.set(\n    title=\"Distribution of wealth at the end of simulation\",\n    xlabel=\"Wealth\",\n    ylabel=\"number of agents\",\n);\nplt.show()\n\n\n\n\n\n\n\n\n\nmodel = py$MoneyModel(100L, 10L, 10L, 1234L)\nwalk(1:100L, ~model$step())\n\n# è¿™é‡Œæœ‰ä¸€ç‚¹éº»çƒ¦çš„æ˜¯ï¼Œnumpyä¼šå»ºç«‹ä¸€ç§å¤šé‡ç´¢å¼•çš„æ•°æ®ç»“æ„\n# è½¬åŒ–ä¸º R tibble æ—¶ä¼šä¸¢æ‰æ‰€æœ‰ç´¢å¼•\n# ä½†ç›´æ¥åœ¨ R ä¸­ call \n# py$model$datacollector$get_agent_vars_dataframe()$reset_index()\n# ä¼šå‡ºç°é—®é¢˜ï¼Œå› æ­¤åœ¨ R ä¸­è¿›è¡Œäº†ä¸€æ¬¡è½¬æ¢ï¼Œ!!!ç›®å‰ reticulate è¿˜æ²¡æœ‰æä¾›æ›´å¥½çš„è§£å†³æ–¹æ³•\nagent_wealth &lt;- model$datacollector$get_agent_vars_dataframe() %&gt;% \n  bind_cols(\n  attributes(.)$pandas.index$to_frame() %&gt;% py_to_r(),\n  .\n)\n\nhead(agent_wealth)\n\n  Step AgentID Wealth\n1    1       1      1\n2    1       2      1\n3    1       3      1\n4    1       4      1\n5    1       5      1\n6    1       6      1\n\nend_wealth = agent_wealth %&gt;% \n  filter(Step == max(Step))\n\nggplot()+\n  geom_histogram(data = end_wealth, aes(Wealth), \n               binwidth = 1, \n               color = \"black\", fill=\"steelblue\")+\n  ggtitle(\"Distribution of wealth at the end of simulation\")+\n  xlab(\"Wealth\")+\n  ylab(\"Number of agents\")+\n  theme_bw()\n\n\n\n\n\n\n\n\nç»˜åˆ¶ Agent 8 çš„è´¢å¯Œå˜åŒ–ã€‚\n\nagent_wealth %&gt;% filter(AgentID == 8) %&gt;% \n  ggplot()+\n  geom_line(aes(Step, Wealth),color = \"steelblue\")+\n  ggtitle(\"Wealth of agent 8 over time\")+\n  theme_bw()\n\n\n\n\n\n\n\n\nç»˜åˆ¶å¤šä¸ª Agent çš„è´¢å¯Œå˜åŒ–ã€‚\n\nagent_wealth %&gt;% filter(AgentID %in% c(3, 14, 25)) %&gt;% \n  ggplot()+\n  geom_line(aes(Step, Wealth,color = factor(AgentID)))+\n  ggtitle(\"Wealth of agent 3, 4 and 25 over time\")+\n  theme_bw()\n\n\n\n\n\n\n\n\nç»˜åˆ¶æ‰€æœ‰ Agent çš„è´¢å¯Œçš„å¹³å‡å€¼å’Œç½®ä¿¡åŒºé—´ã€‚\n\nagent_wealth %&gt;% \n  group_by(Step) %&gt;% \n  summarise(mean = mean(Wealth), \n            lower = mean(Wealth) - 1.96 * sd(Wealth)/sqrt(n()), \n            upper = mean(Wealth) + 1.96 * sd(Wealth)/sqrt(n())) %&gt;% \n  ggplot()+\n  geom_line(aes(Step, mean),color = \"steelblue\")+\n  geom_ribbon(aes(Step, ymin = lower, ymax = upper),\n              fill = \"steelblue\", alpha = 0.2)+\n  ggtitle(\"Average wealth over time\")+\n  theme_bw()\n\n\n\n\n\n\n\nggplot(agent_wealth, aes(x = Step, y = Wealth, group = 1)) +\n  stat_summary(\n    geom      = \"ribbon\",\n    fun.data  = mean_cl_normal,\n    fun.args  = list(conf.int = 0.95),\n    fill      = \"steelblue\",\n    alpha     = 0.2\n  ) +\n  stat_summary(\n    geom = \"line\",\n    fun  = mean,\n    colour = \"steelblue\"\n  ) +\n  ggtitle(\"Average wealth over time\") +\n  theme_bw()"
  },
  {
    "objectID": "index.html#é€‰æ‹©",
    "href": "index.html#é€‰æ‹©",
    "title": "åœ¨ R ä¸­ä½¿ç”¨ Python æ¨¡å— Mesa æ¥åˆ›å»º ABM æ¨¡å‹",
    "section": "6.1 é€‰æ‹©",
    "text": "6.1 é€‰æ‹©\nåœ¨è¿™ä¸ªæ¨¡å‹å˜ä½“ä¸­ï¼Œå°†ä½¿ç”¨ agents.select æŠŠ Agent åˆ†ä¸ºè´«å¯Œä¸¤ç§ã€‚\n\ndef compute_gini(model):\n    agent_wealths = [agent.wealth for agent in model.agents]\n    x = sorted(agent_wealths)\n    n = model.num_agents\n    B = sum(xi * (n - i) for i, xi in enumerate(x)) / (n * sum(x))\n    return 1 + (1 / n) - 2 * B\n\n\nclass MoneyAgent(mesa.Agent):\n    \"\"\"An agent with fixed initial wealth.\"\"\"\n\n    def __init__(self, model):\n        super().__init__(model)\n        self.wealth = 1\n    # åœ¨è¿™é‡Œå®šä¹‰äº†åªç»™poor_agents ä¼ é€’è´¢å¯Œ\n    def give_money(self, poor_agents):\n        if self.wealth &gt; 0:\n            other_agent = self.random.choice(poor_agents)\n            other_agent.wealth += 1\n            self.wealth -= 1\n\n\nclass MoneyModel(mesa.Model):\n    \"\"\"A model with some number of agents.\"\"\"\n\n    def __init__(self, n):\n        super().__init__()\n        self.num_agents = n\n\n        MoneyAgent.create_agents(model=self, n=n)\n\n        self.datacollector = mesa.DataCollector(\n            model_reporters={\"Gini\": compute_gini}, \n            agent_reporters={\"Wealth\": \"wealth\"}\n        )\n\n    def step(self):\n        self.datacollector.collect(self)\n        # ç”¨ agent.select è·å–è´«å¯Œ Agent çš„åˆ—è¡¨\n        # è¿™é‡Œçš„ lambda ç­‰äº R çš„åŒ¿åå‡½æ•° ~\n        # åœ¨åŸæœ¬çš„æ•™ç¨‹ä¸­ï¼Œè¿™é‡Œå†™ä½œmodel.agents.select\n        # è¿™åœ¨åŸç”Ÿ python ç¯å¢ƒä¸­æ²¡æœ‰é—®é¢˜ï¼Œå› ä¸ºåœ¨è°ƒç”¨ model = MoneyModel(100) æ—¶\n        # ä¼šåˆ›å»ºå…¨å±€å˜é‡ modelï¼Œä½†åœ¨ R ä¸­è¿è¡Œæ¨¡å‹æ—¶ï¼Œæ— æ³•æ‰¾åˆ°\n        # å› æ­¤åœ¨è¿™é‡Œæ”¹å†™æˆäº†æ›´è§„èŒƒçš„ self.agents.select\n        rich_agents = self.agents.select(lambda a: a.wealth &gt;= 3)\n        poor_agents = self.agents.select(lambda a: a.wealth &lt; 3)\n        # å½“æœ‰å¯Œè£•çš„ Agent æ—¶ï¼Œå¯Œè£•çš„ Agent ç»™è´«ç©·çš„ Agent ä¼ é€’è´¢å¯Œ\n        if len(rich_agents) &gt; 0:\n            rich_agents.shuffle_do(\"give_money\", poor_agents)\n        else:\n            poor_agents.shuffle_do(\"give_money\", poor_agents)\n\n\nmodel = py$MoneyModel(100L)\nwalk(1:20L, ~model$step())\n\nagent_wealth &lt;- model$datacollector$get_agent_vars_dataframe() %&gt;% \n  bind_cols(\n  attributes(.)$pandas.index$to_frame() %&gt;% py_to_r(),\n  .\n)\n\nagent_wealth  %&gt;%\n  ggplot() +\n  geom_histogram(aes(Wealth), fill = \"steelblue\",binwidth = 1, color = \"black\") +\n  labs(\n    title = \"Wealth distribution\",\n    x     = \"Wealth\",\n    y     = \"Number of agents\"\n  ) + theme_bw()"
  },
  {
    "objectID": "index.html#åˆ†ç»„",
    "href": "index.html#åˆ†ç»„",
    "title": "åœ¨ R ä¸­ä½¿ç”¨ Python æ¨¡å— Mesa æ¥åˆ›å»º ABM æ¨¡å‹",
    "section": "6.2 åˆ†ç»„",
    "text": "6.2 åˆ†ç»„\né€šè¿‡ä¸€ä¸ª characteristics å°† Agent åˆ†ç»„, ä¾‹å¦‚æä¾› Greenã€Blue å’Œ Mixed çš„ç§æ—å±æ€§ï¼Œåªåœ¨åŒç§æ—å†…ç»™é’±ã€‚\n\ndef compute_gini(model):\n    agent_wealths = [agent.wealth for agent in model.agents]\n    x = sorted(agent_wealths)\n    n = model.num_agents\n    B = sum(xi * (n - i) for i, xi in enumerate(x)) / (n * sum(x))\n    return 1 + (1 / n) - 2 * B\n  \nclass MoneyAgent(mesa.Agent):\n    \"\"\"An agent with fixed initial wealth.\"\"\"\n\n    def __init__(self, model, ethnicity):\n        super().__init__(model)\n        self.wealth = 1\n        # å®šä¹‰ Agent çš„ç§æ—\n        self.ethnicity = ethnicity\n\n    def give_money(self, similars):\n        if self.wealth &gt; 0:\n            # ä»åŒç§æ—çš„ Agent ä¸­éšæœºé€‰æ‹©ä¸€ä¸ª\n            other_agent = self.random.choice(similars)\n            other_agent.wealth += 1\n            self.wealth -= 1\n\n\nclass MoneyModel(mesa.Model):\n    \"\"\"A model with some number of agents.\"\"\"\n\n    def __init__(self, n):\n        super().__init__()\n        self.num_agents = n\n\n        # åˆ›å»ºä¸€ä¸ªç§æ—åˆ—è¡¨\n        ethnicities = [\"Green\", \"Blue\", \"Mixed\"]\n\n        MoneyAgent.create_agents(\n            model=self,\n            n=self.num_agents,\n            # ä»ç§æ—åˆ—è¡¨ä¸­éšæœºé€‰æ‹©ç§æ—\n            ethnicity=self.random.choices(ethnicities, k=self.num_agents),\n        )\n\n        self.datacollector = mesa.DataCollector(\n            model_reporters={\"Gini\": compute_gini},\n            agent_reporters={\"Wealth\": \"wealth\", \"Ethnicity\": \"ethnicity\"},\n        )\n\n    def step(self):\n        self.datacollector.collect(self)\n        # åˆ›å»ºä¸€ä¸ªå­—å…¸ï¼Œå­˜å‚¨ Agent çš„ç§æ—\n        grouped_agents = self.agents.groupby(\"ethnicity\")\n        for ethnic, similars in grouped_agents:\n            if ethnic != \"Mixed\":\n                similars.shuffle_do(\"give_money\", similars)\n            else:\n                similars.shuffle_do(\n                    \"give_money\", self.agents\n                )  # Mixed å¯ä»¥ç»™æ‰€æœ‰äººé’±\n\n\nmodel = py$MoneyModel(100L)\nwalk(1:20L, ~model$step())\n\nagent_wealth &lt;- model$datacollector$get_agent_vars_dataframe() %&gt;% \n  bind_cols(\n  attributes(.)$pandas.index$to_frame() %&gt;% py_to_r(),\n  .\n)\n\nagent_wealth %&gt;% \n  ggplot()+\n  geom_histogram(aes(Wealth, fill = Ethnicity),binwidth = 1, color = \"black\")+\n  theme_bw()+\n  scale_fill_manual(values = c(\"Green\" = \"darkgreen\", \n                               \"Blue\" = \"darkblue\", \n                               \"Mixed\" = \"purple3\")) +\n  labs(title = \"Wealth distribution\")"
  },
  {
    "objectID": "index.html#å¯¼å…¥ä¾èµ–",
    "href": "index.html#å¯¼å…¥ä¾èµ–",
    "title": "åœ¨ R ä¸­ä½¿ç”¨ Python æ¨¡å— Mesa æ¥åˆ›å»º ABM æ¨¡å‹",
    "section": "7.1 å¯¼å…¥ä¾èµ–",
    "text": "7.1 å¯¼å…¥ä¾èµ–\n\nfrom mesa.visualization import SolaraViz, make_plot_component, make_space_component"
  },
  {
    "objectID": "index.html#åŸºç¡€æ¨¡å‹-1",
    "href": "index.html#åŸºç¡€æ¨¡å‹-1",
    "title": "åœ¨ R ä¸­ä½¿ç”¨ Python æ¨¡å— Mesa æ¥åˆ›å»º ABM æ¨¡å‹",
    "section": "7.2 åŸºç¡€æ¨¡å‹",
    "text": "7.2 åŸºç¡€æ¨¡å‹\nä¸ä¸Šè¿°æ¨¡å‹ç›¸åŒã€‚\n\ndef compute_gini(model):\n    agent_wealths = [agent.wealth for agent in model.agents]\n    x = sorted(agent_wealths)\n    N = model.num_agents\n    B = sum(xi * (N - i) for i, xi in enumerate(x)) / (N * sum(x))\n    return 1 + (1 / N) - 2 * B\n\n\nclass MoneyAgent(CellAgent):\n    \"\"\"An agent with fixed initial wealth.\"\"\"\n\n    def __init__(self, model, cell):\n        \"\"\"initialize a MoneyAgent instance.\n\n        Args:\n            model: A model instance\n        \"\"\"\n        super().__init__(model)\n        self.cell = cell\n        self.wealth = 1\n\n    def move(self):\n        \"\"\"Move the agent to a random neighboring cell.\"\"\"\n        self.cell = self.cell.neighborhood.select_random_cell()\n\n    def give_money(self):\n        \"\"\"Give 1 unit of wealth to a random agent in the same cell.\"\"\"\n        cellmates = [a for a in self.cell.agents if a is not self]\n\n        if cellmates:  # Only give money if there are other agents present\n            other = self.random.choice(cellmates)\n            other.wealth += 1\n            self.wealth -= 1\n\n    def step(self):\n        \"\"\"do one step of the agent.\"\"\"\n        self.move()\n        if self.wealth &gt; 0:\n            self.give_money()\n\n\nclass MoneyModel(mesa.Model):\n    \"\"\"A model with some number of agents.\"\"\"\n\n    def __init__(self, n=10, width=10, height=10, seed=None):\n        \"\"\"Initialize a MoneyModel instance.\n\n        Args:\n            N: The number of agents.\n            width: width of the grid.\n            height: Height of the grid.\n        \"\"\"\n        super().__init__(seed=seed)\n        self.num_agents = n\n        self.grid = OrthogonalMooreGrid((width, height), random=self.random)\n\n        # Create agents\n        MoneyAgent.create_agents(\n            self,\n            self.num_agents,\n            self.random.choices(self.grid.all_cells.cells, k=self.num_agents),\n        )\n\n        self.datacollector = mesa.DataCollector(\n            model_reporters={\"Gini\": compute_gini}, agent_reporters={\"Wealth\": \"wealth\"}\n        )\n        self.datacollector.collect(self)\n\n    def step(self):\n        \"\"\"do one step of the model\"\"\"\n        self.agents.shuffle_do(\"step\")\n        self.datacollector.collect(self)\n\n\nlibrary(shiny)\nui &lt;- fluidPage(\n  titlePanel(\"Boltzmann è´¢å¯Œæ¨¡å‹ï¼ˆShinyï¼‹reticulateï¼‰\"),\n  sidebarLayout(\n    sidebarPanel(\n      sliderInput(\"n_agents\", \"ä»£ç†äººæ•°\", \n                  min = 10, max = 200, value = 50, step = 1),\n      sliderInput(\"grid_w\", \"ç½‘æ ¼å®½åº¦\", \n                  min = 5, max = 50, value = 10, step = 1),\n      sliderInput(\"grid_h\", \"ç½‘æ ¼é«˜åº¦\", \n                  min = 5, max = 50, value = 10, step = 1),\n      actionButton(\"reset_btn\", \"ğŸ”„ Reset\"),\n      actionButton(\"step_btn\",  \"â–¶ï¸ Step\")\n    ),\n    mainPanel(\n      plotOutput(\"grid_plot\", height = \"500px\"),\n      plotOutput(\"gini_plot\", height = \"250px\")\n    )\n  )\n)\n\n# â€”â€” 3. Server é€»è¾‘ â€”â€” \nserver &lt;- function(input, output, session) {\n  # å­˜æ¨¡å‹å®ä¾‹å’Œå†å²æ•°æ®\n  model_r   &lt;- reactiveVal(NULL)\n  step_count &lt;- reactiveVal(0L)\n  gini_hist &lt;- reactiveVal(tibble(step = 0L, Gini = compute_gini(py_to_r(\n    source_python(\"money_model.py\")  # ä¸´æ—¶ç®—ä¸€ä¸‹åˆå§‹ Gini\n  )$wealth)))\n  \n  # â€”â€” é‡ç½®æ¨¡å‹ â€”â€” \n  observeEvent(input$reset_btn, {\n    # æ–°å»º Python æ¨¡å‹å®ä¾‹\n    py_model &lt;- MoneyModel(\n      n      = as.integer(input$n_agents),\n      width  = as.integer(input$grid_w),\n      height = as.integer(input$grid_h),\n      seed   = 42L\n    )\n    model_r(py_model)\n    step_count(0L)\n    \n    # åˆå§‹åŒ– Gini å†å²\n    pd0 &lt;- py_model$datacollector$get_model_vars_dataframe()$reset_index()\n    df0 &lt;- py_to_r(pd0) %&gt;% rename(step = index)\n    gini_hist(df0)\n  }, ignoreNULL = FALSE)  # å¯åŠ¨æ—¶ä¹Ÿè§¦å‘ä¸€æ¬¡\n  \n  # â€”â€” å•æ­¥æ¨è¿› â€”â€” \n  observeEvent(input$step_btn, {\n    req(model_r())\n    # è°ƒç”¨ Python çš„ step()\n    model_r()$step()\n    # æ›´æ–°è®¡æ•°\n    sc &lt;- step_count() + 1L\n    step_count(sc)\n    # æ‹‰å–æœ€æ–° Gini å†å²\n    pd_mod &lt;- model_r()$datacollector$get_model_vars_dataframe()$reset_index()\n    df_g &lt;- py_to_r(pd_mod) %&gt;% rename(step = index)\n    gini_hist(df_g)\n  })\n  \n  # â€”â€” ç»˜åˆ¶ç½‘æ ¼å›¾ â€”â€” \n  output$grid_plot &lt;- renderPlot({\n    req(model_r())\n    # æ‹‰å–æ‰€æœ‰ agent çš„æœ€æ–°çŠ¶æ€\n    pd_ag &lt;- model_r()$datacollector$get_agent_vars_dataframe()$reset_index()\n    df_ag &lt;- py_to_r(pd_ag) %&gt;%\n      rename(step = level_0, agent_id = level_1, wealth = wealth) %&gt;%\n      mutate(across(c(step, agent_id), as.integer)) %&gt;%\n      filter(step == step_count())\n    \n    ggplot(df_ag, aes(x = x, y = y)) +\n      geom_point(aes(size = wealth, color = wealth), alpha = 0.8) +\n      scale_size_continuous(range = c(2, 8)) +\n      scale_color_viridis_c() +\n      coord_fixed(expand = FALSE) +\n      labs(title = paste(\"Step\", step_count()),\n           x = NULL, y = NULL) +\n      theme_minimal() +\n      theme(legend.position = \"right\")\n  })\n  \n  # â€”â€” ç»˜åˆ¶ Gini éšæ­¥æ•°å˜åŒ– â€”â€” \n  output$gini_plot &lt;- renderPlot({\n    df_g &lt;- gini_hist()\n    ggplot(df_g, aes(step, Gini)) +\n      geom_line() +\n      geom_point(size = 1.5) +\n      labs(title = \"Gini æŒ‡æ•°éšæ­¥æ•°å˜åŒ–\",\n           x = \"Step\", y = \"Gini\") +\n      theme_minimal()\n  })\n}\n\nshinyApp(ui, server)"
  }
]